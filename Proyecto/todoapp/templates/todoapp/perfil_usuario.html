{% extends 'todoapp/menu.html' %}
{% load static %}

{% block title %} Perfil {% endblock %}

{% block content %}
    <div class="background_title1">
        <h3 class="title">Mi Perfil</h3>
    </div> 
    <br>

    <div class="container">
        <div class="form-group lr_field_form">
            <!-- Mostrar Nombre del usuario-->
            <label for="nombre_usuario">Nombre</label>
            <input type="text" class="form-control" id="nombre_usuario" name="username" readonly placeholder="Inserte Nombre" value="{{ user.username }}">

            <!-- Mostrar Correo del usuario-->
            <label for="correo_usuario">Correo</label>
            <input type="text" class="form-control" id="correo_usuario" name="username" readonly placeholder="Inserte Nombre" value="{{ user.email }}">

            <!-- Mostrar Celular del usuario-->
            <label for="celular">Celular</label>
            <!-- Usuario ha registrado celular -->
            {% if user.celular %}
                <form method="post" action="{% url 'perfil_usuario' %}">
                    {% csrf_token %}
                    <div class="">
                        <input type="text" class="form-control" id="celular" name="celular" readonly placeholder="Inserte Nombre" value="{{ user.celular }}">
                        <div class="input-group-append">
                            <button type="button" class="btn btn-primary" id="editar-celular">Editar</button>
                            <button type="submit" class="btn btn-success d-none" id="guardar-celular" name="guardar_celular">Guardar cambios</button>
                        </div>
                    </div>
                </form>
            <!-- Usuario no ha registrado celular -->
            {% else %}
                <form method="post" action="{% url 'perfil_usuario' %}">
                    {% csrf_token %}
                    <div class="">
                        <input type="text" class="form-control" id="celular" name="celular" readonly placeholder="No hay celular registrado.">
                        <div class="input-group-append">
                            <button type="button" class="btn btn-primary" id="editar-celular">Editar</button>
                            <button type="submit" class="btn btn-success d-none" id="guardar-celular" name="guardar_celular">Guardar cambios</button>
                        </div>
                    </div>
                </form>
            {% endif %}

            <!-- Mostrar Ubicación Personal del usuario-->
            <label for="ubicacion">Ubicación Personal</label>
            <!-- Usuario ha registrado una ubicación personal -->
            {% if user.ubicacion_personal %}
                <form method="post" action="{% url 'perfil_usuario' %}">
                    {% csrf_token %}
                    <div class="">
                        <input type="text" class="form-control" id="ubicacion" name="ubicacion" readonly placeholder="Ubicación Personal" value="{{ user.ubicacion_personal }}">
                        <div class="input-group-append">
                            <button type="button" class="btn btn-primary" id="editar-ubicacion">Editar</button>
                            <button type="submit" class="btn btn-success d-none" id="guardar-ubicacion" name="guardar_ubicacion_personal">Guardar cambios</button>
                        </div>
                    </div>
                </form>
            <!-- Usuario no ha registrado una ubicación personal -->
            {% else %}
                <form method="post" action="{% url 'perfil_usuario' %}">
                    {% csrf_token %}
                    <div class="">
                        <input type="text" class="form-control" id="ubicacion" name="ubicacion" readonly placeholder="Ubicación Personal">
                        <div class="input-group-append">
                            <button type="button" class="btn btn-primary" id="editar-ubicacion">Editar</button>
                            <button type="submit" class="btn btn-success d-none" id="guardar-ubicacion" name="guardar_ubicacion_personal">Guardar cambios</button>
                        </div>
                    </div>
                </form>
            {% endif %}
        </div>

        <!-- Botón de Cierre de sesión-->
        <a href="{% url 'logout' %}" class="btn d-block mx-auto form-group custom-button-logout">Cerrar Sesión</a>
    </div>

    <br>
    <!-- nueva publicacion -->
    <div class="background_title1">
        <h3 class="title">Mis Publicaciones</h3>
        <div>
            <form action="{% url 'ficha_animal' %}">
                <button type="submit" class="custom_rounded btn btn-primary d-block title_button">
                    Nueva 
                    <br>
                    Publicación
                </button>
            </form>
        </div>
    </div>
    
    <!-- Espacio entre título y publicaciones -->
    <div class="mt-4"></div>
    
    <!-- Sección que representa las publicaciones del usuario -->
    <div class="container">
        <div class="row" id="results-container">
            {% for mascota in publicaciones %}
            <a href="post/{{mascota.id}}" class="btn btn-outline-success" formaction="" style="color: black;">
                <div class="" data-mascota-id="{{ mascota.id }}">
                    <div class="animal-card">
                        <h5>{{ mascota.nombre }}</h5>
                        <hr>
                        <div class="justify-content-center">
                            {% if mascota.fotos.exists %}
                                <img src="{{ mascota.fotos.first.archivo.url }}" alt="{{ mascota.nombre }}" class="img-fluid img-thumbnail img_post_size">
                            {% else %}
                                <img src="{% static 'todoapp/img/placeholder.png' %}" alt="Sin imagen" class="img-fluid img-thumbnail img_post_size">
                            {% endif %}
                        </div>
                        <hr>
                        <ul class="list-unstyled">
                            <li class="d-flex justify-content-between">
                                <strong style="background-color: rgba(174, 200, 180, 1); text-align: left;">
                                    Fecha de extravío:
                                </strong>
                                <span>{{ mascota.fecha_extravio|date:"d/m/Y" }}</span>
                            </li>
                            <li class="d-flex justify-content-between">
                                <strong style="background-color: rgba(174, 200, 180, 1); text-align: left; height: max-content;">
                                    Ubicación de extravío:
                                </strong>
                                <span style="width: 150px; text-align: right; white-space: nowrap; overflow: hidden; text-overflow: clip; height: max-content;">
                                    {{ mascota.ubicacion_extravio }}
                                </span>
                            </li>
                            <li class="d-flex justify-content-between">
                                <strong style="background-color: rgba(174, 200, 180, 1); text-align: left; height: max-content;">
                                    Color:
                                </strong>
                                <span>{{ mascota.color }}</span>
                            </li>
                            <li class="d-flex justify-content-between">
                                <strong style="background-color: rgba(174, 200, 180, 1); text-align: left; height: max-content;">
                                    Raza:
                                </strong>
                                <span>{{ mascota.raza }}</span>
                            </li>
                            <li class="d-flex justify-content-between">
                                <strong style="background-color: rgba(174, 200, 180, 1); text-align: left; height: max-content;">
                                    Tiene chip:
                                </strong>
                                <span>{% if mascota.tiene_chip %}Sí{% else %}No{% endif %}</span>
                            </li>
                            <li class="d-flex justify-content-between">
                                <strong style="background-color: rgba(174, 200, 180, 1); text-align: left; height: max-content;">
                                    Descripción:
                                </strong>
                                <span style="width: 250px; text-align: right; overflow: hidden; text-overflow: clip; white-space: pre-wrap;">{{ mascota.descripcion }}</span>
                            </li>
                        </ul>
                        
                    </div>
                </div>
            </a>
            {% empty %}
            <div class="col">
                <p>No tienes publicaciones.</p>
            </div>
            {% endfor %}
        </div>
    </div>
    <br>
    <br>
    <br>
    <br>

    <!-- Javascript -->
    <script>
        /* Permite que el campo "Celular" sea editable, que se oculte el boton "Editar" y se muestre "Guardar Cambios*/
        document.getElementById('editar-celular').addEventListener('click', function() {
            document.getElementById('celular').removeAttribute('readonly');
            document.getElementById('guardar-celular').classList.remove('d-none');
            this.classList.add('d-none');
        });
        /* Permite que el campo "Ubicacion Personal" sea editable, que se oculte el boton "Editar" y se muestre "Guardar Cambios*/
        document.getElementById('editar-ubicacion').addEventListener('click', function() {
            document.getElementById('ubicacion').removeAttribute('readonly');
            document.getElementById('guardar-ubicacion').classList.remove('d-none');
            this.classList.add('d-none');
        });
    </script>
{% endblock %}
